# relevant links:
# - https://github.com/marketplace/actions/ros-2-ci-action
# - https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html#new-directory
# - https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html#build-a-package
# - https://docs.ros.org/en/foxy/Tutorials/Intermediate/Testing/CLI.html
# - https://docs.github.com/en/actions/using-workflows/storing-workflow-data-as-artifacts

name: ROS CI

on: [push]

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Build packages
        run: |
          colcon build
      - name: Run HAROS
        run: |
          haros analysis
      - name: Run tests
        run: |
          colcon test
      - name: Archive production artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dist-without-markdown
          path: |
            dist
            !dist/**/*.md
      - name: Archive code coverage results
        uses: actions/upload-artifact@v3
        with:
          name: code-coverage-report
          path: output/test/code-coverage.html
